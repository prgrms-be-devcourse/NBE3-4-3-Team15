var G=/\{[^{}]+\}/g,M=()=>typeof process=="object"&&Number.parseInt(process?.versions?.node?.substring(0,2))>=18&&process.versions.undici;function Q(){return Math.random().toString(36).slice(2,11)}function L(n){let{baseUrl:e="",Request:t=globalThis.Request,fetch:i=globalThis.fetch,querySerializer:r,bodySerializer:o,headers:c,requestInitExt:u=void 0,...v}={...n};u=M()?u:void 0,e=H(e);let h=[];async function p(l,s){let{baseUrl:y,fetch:U=i,Request:Y=t,headers:B,params:w={},parseAs:A="json",querySerializer:E,bodySerializer:I=o??K,body:P,...S}=s||{};y&&(e=H(y));let $=typeof r=="function"?r:D(r);E&&($=typeof E=="function"?E:D({...typeof r=="object"?r:{},...E}));let O=P===void 0?void 0:I(P),W=O===void 0||O instanceof FormData?{}:{"Content-Type":"application/json"},F={redirect:"follow",...v,...S,body:O,headers:X(W,c,B,w.header)},j,T,m=new t(V(l,{baseUrl:e,params:w,querySerializer:$}),F);for(let f in S)f in m||(m[f]=S[f]);if(h.length){j=Q(),T=Object.freeze({baseUrl:e,fetch:U,parseAs:A,querySerializer:$,bodySerializer:I});for(let f of h)if(f&&typeof f=="object"&&typeof f.onRequest=="function"){let d=await f.onRequest({request:m,schemaPath:l,params:w,options:T,id:j});if(d){if(!(d instanceof t))throw new Error("onRequest: must return new Request() when modifying the request");m=d}}}let a;try{a=await U(m,u)}catch(f){let d=f;if(h.length)for(let b=h.length-1;b>=0;b--){let x=h[b];if(x&&typeof x=="object"&&typeof x.onError=="function"){let R=await x.onError({request:m,error:d,schemaPath:l,params:w,options:T,id:j});if(R){if(R instanceof Response){d=void 0,a=R;break}if(R instanceof Error){d=R;continue}throw new Error("onError: must return new Response() or instance of Error")}}}if(d)throw d}if(h.length)for(let f=h.length-1;f>=0;f--){let d=h[f];if(d&&typeof d=="object"&&typeof d.onResponse=="function"){let b=await d.onResponse({request:m,response:a,schemaPath:l,params:w,options:T,id:j});if(b){if(!(b instanceof Response))throw new Error("onResponse: must return new Response() when modifying the response");a=b}}}if(a.status===204||a.headers.get("Content-Length")==="0")return a.ok?{data:void 0,response:a}:{error:void 0,response:a};if(a.ok)return A==="stream"?{data:a.body,response:a}:{data:await a[A](),response:a};let q=await a.text();try{q=JSON.parse(q)}catch{}return{error:q,response:a}}return{request(l,s,y){return p(s,{...y,method:l.toUpperCase()})},GET(l,s){return p(l,{...s,method:"GET"})},PUT(l,s){return p(l,{...s,method:"PUT"})},POST(l,s){return p(l,{...s,method:"POST"})},DELETE(l,s){return p(l,{...s,method:"DELETE"})},OPTIONS(l,s){return p(l,{...s,method:"OPTIONS"})},HEAD(l,s){return p(l,{...s,method:"HEAD"})},PATCH(l,s){return p(l,{...s,method:"PATCH"})},TRACE(l,s){return p(l,{...s,method:"TRACE"})},use(...l){for(let s of l)if(s){if(typeof s!="object"||!("onRequest"in s||"onResponse"in s||"onError"in s))throw new Error("Middleware must be an object with one of `onRequest()`, `onResponse() or `onError()`");h.push(s)}},eject(...l){for(let s of l){let y=h.indexOf(s);y!==-1&&h.splice(y,1)}}}}var C=class{constructor(e,t){this.client=e,this.url=t}GET(e){return this.client.GET(this.url,e)}PUT(e){return this.client.PUT(this.url,e)}POST(e){return this.client.POST(this.url,e)}DELETE(e){return this.client.DELETE(this.url,e)}OPTIONS(e){return this.client.OPTIONS(this.url,e)}HEAD(e){return this.client.HEAD(this.url,e)}PATCH(e){return this.client.PATCH(this.url,e)}TRACE(e){return this.client.TRACE(this.url,e)}},z=class{constructor(){this.client=null}get(e,t){let i=new C(e,t);return this.client[t]=i,i}};function J(n){let e=new z,t=new Proxy(n,e);function i(){}i.prototype=t;let r=new i;return e.client=r,r}function Z(n){return J(L(n))}function g(n,e,t){if(e==null)return"";if(typeof e=="object")throw new Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${n}=${t?.allowReserved===!0?e:encodeURIComponent(e)}`}function N(n,e,t){if(!e||typeof e!="object")return"";let i=[],r={simple:",",label:".",matrix:";"}[t.style]||"&";if(t.style!=="deepObject"&&t.explode===!1){for(let u in e)i.push(u,t.allowReserved===!0?e[u]:encodeURIComponent(e[u]));let c=i.join(",");switch(t.style){case"form":return`${n}=${c}`;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return c}}for(let c in e){let u=t.style==="deepObject"?`${n}[${c}]`:c;i.push(g(u,e[c],t))}let o=i.join(r);return t.style==="label"||t.style==="matrix"?`${r}${o}`:o}function k(n,e,t){if(!Array.isArray(e))return"";if(t.explode===!1){let o={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[t.style]||",",c=(t.allowReserved===!0?e:e.map(u=>encodeURIComponent(u))).join(o);switch(t.style){case"simple":return c;case"label":return`.${c}`;case"matrix":return`;${n}=${c}`;default:return`${n}=${c}`}}let i={simple:",",label:".",matrix:";"}[t.style]||"&",r=[];for(let o of e)t.style==="simple"||t.style==="label"?r.push(t.allowReserved===!0?o:encodeURIComponent(o)):r.push(g(n,o,t));return t.style==="label"||t.style==="matrix"?`${i}${r.join(i)}`:r.join(i)}function D(n){return function(t){let i=[];if(t&&typeof t=="object")for(let r in t){let o=t[r];if(o!=null){if(Array.isArray(o)){if(o.length===0)continue;i.push(k(r,o,{style:"form",explode:!0,...n?.array,allowReserved:n?.allowReserved||!1}));continue}if(typeof o=="object"){i.push(N(r,o,{style:"deepObject",explode:!0,...n?.object,allowReserved:n?.allowReserved||!1}));continue}i.push(g(r,o,n))}}return i.join("&")}}function _(n,e){let t=n;for(let i of n.match(G)??[]){let r=i.substring(1,i.length-1),o=!1,c="simple";if(r.endsWith("*")&&(o=!0,r=r.substring(0,r.length-1)),r.startsWith(".")?(c="label",r=r.substring(1)):r.startsWith(";")&&(c="matrix",r=r.substring(1)),!e||e[r]===void 0||e[r]===null)continue;let u=e[r];if(Array.isArray(u)){t=t.replace(i,k(r,u,{style:c,explode:o}));continue}if(typeof u=="object"){t=t.replace(i,N(r,u,{style:c,explode:o}));continue}if(c==="matrix"){t=t.replace(i,`;${g(r,u)}`);continue}t=t.replace(i,c==="label"?`.${encodeURIComponent(u)}`:encodeURIComponent(u))}return t}function K(n){return n instanceof FormData?n:JSON.stringify(n)}function V(n,e){let t=`${e.baseUrl}${n}`;e.params?.path&&(t=_(t,e.params.path));let i=e.querySerializer(e.params.query??{});return i.startsWith("?")&&(i=i.substring(1)),i&&(t+=`?${i}`),t}function X(...n){let e=new Headers;for(let t of n){if(!t||typeof t!="object")continue;let i=t instanceof Headers?t.entries():Object.entries(t);for(let[r,o]of i)if(o===null)e.delete(r);else if(Array.isArray(o))for(let c of o)e.append(r,c);else o!==void 0&&e.set(r,o)}return e}function H(n){return n.endsWith("/")?n.substring(0,n.length-1):n}export{V as createFinalURL,Z as createPathBasedClient,D as createQuerySerializer,L as default,K as defaultBodySerializer,_ as defaultPathSerializer,X as mergeHeaders,Q as randomID,H as removeTrailingSlash,k as serializeArrayParam,N as serializeObjectParam,g as serializePrimitiveParam,J as wrapAsPathBasedClient};
